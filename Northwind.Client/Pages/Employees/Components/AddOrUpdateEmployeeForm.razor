@using Northwind.Shared.Employees.Commands
<EditForm Model="@Command" OnValidSubmit="OnValidSubmitAsync">
    <FluentValidationValidator/>

    <MudGrid>
        <!-- First Name Row -->
        <MudItem xs="12">
            <MudTextField Label="First Name" @bind-Value="Command.FirstName"/>
            <ValidationMessage For="() => Command.FirstName"/>
        </MudItem>

        <!-- Last Name Row -->
        <MudItem xs="12">
            <MudTextField Label="Last Name" @bind-Value="Command.LastName"/>
            <ValidationMessage For="() => Command.LastName"/>
        </MudItem>

        <!-- Title Row -->
        <MudItem xs="12">
            <MudTextField Label="Title" @bind-Value="Command.Title"/>
            <ValidationMessage For="() => Command.Title"/>
        </MudItem>

        <!-- Birth Date Row -->
        <MudItem xs="12">
            <MudDatePicker Label="Birth Date" @bind-Value="Command.BirthDate"
                           PickerVariant="PickerVariant.Dialog" DateFormat="dd/MM/yyyy"/>
            <ValidationMessage For="() => Command.BirthDate"/>
        </MudItem>
    
        <!-- Submit Button -->
        <MudItem xs="4">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit">Submit
            </MudButton>

            <MudButton Variant="Variant.Filled" Color="Color.Error" Href="@Routes.Pages.Employees.GetAllEmployees">Cancel
            </MudButton>
        </MudItem>
    </MudGrid>
</EditForm>


@code {

    [Parameter, EditorRequired] public AddOrUpdateEmployeeCommand Command { get; set; } = null!;
    private bool IsEditingExistingBlog => Command.EmployeeId > 0;

    [Inject] public HttpClient HttpClient { get; set; } = null!;
    [Inject] public NavigationManager NavigationManager { get; set; } = null!;

    private async Task OnValidSubmitAsync()
    {
        HttpResponseMessage response;

        if (IsEditingExistingBlog)
            response = await HttpClient.PutAsJsonAsync(Routes.Api.Employees.Update, Command);
        else
            response = await HttpClient.PostAsJsonAsync(Routes.Api.Employees.Add, Command);

        if (response.IsSuccessStatusCode)
            NavigationManager.NavigateTo(Routes.Pages.Employees.GetAllEmployees);
    }


}